<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
        let numHearts = 10;
        let maxScale = 20;
        let drawProgress = 0;
        let currentHeart = 0;
        let popAnimation = false;
        let smallHearts = [];
        
        function setup() {
            createCanvas(windowWidth, windowHeight);
            noFill();
            frameRate(30);
        }

        function draw() {
            background(0);
            translate(width / 2, height / 2);

            for (let i = 0; i < currentHeart; i++) {
                drawHeart(i, 1, true);
            }

            if (currentHeart < numHearts) {
                drawHeart(currentHeart, drawProgress, false);
                drawProgress += 0.02;

                if (drawProgress >= 1) {
                    drawProgress = 0;
                    currentHeart++;
                }
            } else if (currentHeart === numHearts && !popAnimation) {
                popAnimation = true;
                createSmallHearts();
            }

            if (popAnimation) {
                popHearts();
            }
        }

        function drawHeart(heartIndex, progress, fillColor) {
            let scale = map(heartIndex, 0, numHearts, maxScale, 0);
            let colorValue = map(heartIndex, 0, numHearts, 0.3, 1);
            let strokeColor = lerpColor(color(255, 0, 0), color(255, 182, 193), colorValue);

            stroke(strokeColor);
            strokeWeight(6);
            noFill();
            drawingContext.shadowBlur = 20;
            drawingContext.shadowColor = strokeColor;

            beginShape();
            let startTheta = 0;
            let endTheta = TWO_PI * progress;

            for (let theta = startTheta; theta < endTheta; theta += 0.01) {
                let x = scale * 16 * pow(sin(theta), 3);
                let y = -scale * (13 * cos(theta) - 5 * cos(2 * theta) - 2 * cos(3 * theta) - cos(4 * theta));
                vertex(x, y);
            }
            endShape();

            if (fillColor) {
                fill(strokeColor);
                beginShape();
                for (let theta = 0; theta < TWO_PI; theta += 0.01) {
                    let x = scale * 16 * pow(sin(theta), 3);
                    let y = -scale * (13 * cos(theta) - 5 * cos(2 * theta) - 2 * cos(3 * theta) - cos(4 * theta));
                    vertex(x, y);
                }
                endShape(CLOSE);
            }
            drawingContext.shadowBlur = 0;
        }

        function createSmallHearts() {
            let smallHeartCount = 10;
            for (let i = 0; i < smallHeartCount; i++) {
                let angle = random(TWO_PI);
                let radius = random(0, height / 2);

                let xOffset = cos(angle) * radius;
                let yOffset = sin(angle) * radius;

                smallHearts.push({ 
                    x: xOffset, 
                    y: height / 2 + 50,
                    scale: random(5, 10), 
                    alpha: 255,
                    speed: random(2, 5)
                });
            }
        }

        function popHearts() {
            for (let i = smallHearts.length - 1; i >= 0; i--) {
                let smallHeart = smallHearts[i];
                smallHeart.y -= smallHeart.speed;
                smallHeart.alpha -= 5;

                noStroke();
                fill(255, 0, 0, smallHeart.alpha);
                drawingContext.shadowBlur = 20;
                drawingContext.shadowColor = color(255, 0, 0);
                draw3DHeart(smallHeart.x, smallHeart.y, smallHeart.scale);

                if (smallHeart.y < -50 || smallHeart.alpha <= 0) {
                    smallHearts.splice(i, 1);
                }
            }

            if (smallHearts.length === 0) {
                popAnimation = false;
            }
        }

        function draw3DHeart(x, y, scale) {
            beginShape();
            for (let theta = 0; theta < TWO_PI; theta += 0.1) {
                let heartX = scale * 16 * pow(sin(theta), 3);
                let heartY = -scale * (13 * cos(theta) - 5 * cos(2 * theta) - 2 * cos(3 * theta) - cos(4 * theta));
                vertex(x + heartX, y + heartY);
            }
            endShape(CLOSE);
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</head>
<body>
</body>
</html>
